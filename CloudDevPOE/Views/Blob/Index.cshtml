@{
    ViewData["Title"] = "Blob Storage";
    var allBlobUrls = ViewBag.AllBlobUrls as List<string> ?? new List<string>();
    var imageUrls = ViewBag.ImageUrls as List<string> ?? new List<string>();
    var videoUrls = ViewBag.VideoUrls as List<string> ?? new List<string>();
    var documentUrls = ViewBag.DocumentUrls as List<string> ?? new List<string>();
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2><i class="fas fa-images"></i> Blob Storage</h2>
    <a asp-action="Upload" class="btn btn-primary">
        <i class="fas fa-upload"></i> Upload File
    </a>
</div>

<!-- Tabs for different file types -->
<ul class="nav nav-tabs" id="blobTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button">
            <i class="fas fa-file"></i> All Files (@allBlobUrls.Count)
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="images-tab" data-bs-toggle="tab" data-bs-target="#images" type="button">
            <i class="fas fa-image"></i> Images (@imageUrls.Count)
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="videos-tab" data-bs-toggle="tab" data-bs-target="#videos" type="button">
            <i class="fas fa-video"></i> Videos (@videoUrls.Count)
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents" type="button">
            <i class="fas fa-file-alt"></i> Documents (@documentUrls.Count)
        </button>
    </li>
</ul>

<div class="tab-content" id="blobTabContent">
    <!-- All Files Tab -->
    <div class="tab-pane fade show active" id="all" role="tabpanel">
        <div class="card mt-3">
            <div class="card-body">
                @if (allBlobUrls.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>File URL</th>
                                    <th>Type</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    int fileIndex = 1;
                                }
                                @foreach (var url in allBlobUrls)
                                {
                                    var fileType = "Document";
                                    var iconClass = "fa-file";

                                    if (url.Contains("/images/"))
                                    {
                                        fileType = "Image";
                                        iconClass = "fa-image";
                                    }
                                    else if (url.Contains("/videos/"))
                                    {
                                        fileType = "Video";
                                        iconClass = "fa-video";
                                    }

                                    <tr>
                                        <td>
                                            <i class="fas @iconClass"></i>
                                            <span class="text-truncate" style="max-width: 300px; display: inline-block;" title="@url">
                                                File @fileIndex (@fileType.ToLower())
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge bg-secondary">@fileType</span>
                                        </td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <a href="@url" target="_blank" class="btn btn-sm btn-outline-primary" title="View file">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <a asp-action="Download" asp-route-url="@url" class="btn btn-sm btn-outline-success" title="Download file">
                                                    <i class="fas fa-download"></i>
                                                </a>
                                                <form asp-action="Delete" method="post" style="display: inline;">
                                                    <input type="hidden" name="url" value="@url" />
                                                    <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this file?')" title="Delete file">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                    fileIndex++;
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="text-center py-4">
                        <i class="fas fa-folder-open fa-3x text-muted"></i>
                        <p class="mt-3">No files uploaded yet.</p>
                        <a asp-action="Upload" class="btn btn-primary">Upload Your First File</a>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Images Tab -->
    <div class="tab-pane fade" id="images" role="tabpanel">
        <div class="row mt-3">
            @if (imageUrls.Any())
            {
                @for (int imageIndex = 0; imageIndex < imageUrls.Count; imageIndex++)
                {
                    var imageUrl = imageUrls[imageIndex];
                    <div class="col-md-3 mb-3">
                        <div class="card">
                            <img src="@imageUrl" class="card-img-top" alt="Image @(imageIndex + 1)" style="height: 200px; object-fit: cover;">
                            <div class="card-body p-2">
                                <small class="text-muted">Image @(imageIndex + 1)</small>
                                <div class="btn-group w-100 mt-2" role="group">
                                    <a href="@imageUrl" target="_blank" class="btn btn-sm btn-outline-primary">View</a>
                                    <form asp-action="Delete" method="post" style="display: inline;">
                                        <input type="hidden" name="url" value="@imageUrl" />
                                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this image?')">Delete</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12">
                    <div class="text-center py-4">
                        <i class="fas fa-image fa-3x text-muted"></i>
                        <p class="mt-3">No images uploaded yet.</p>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Videos Tab -->
    <div class="tab-pane fade" id="videos" role="tabpanel">
        <div class="row mt-3">
            @if (videoUrls.Any())
            {
                @for (int videoIndex = 0; videoIndex < videoUrls.Count; videoIndex++)
                {
                    var videoUrl = videoUrls[videoIndex];
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <video controls class="card-img-top" style="height: 300px;">
                                <source src="@videoUrl" type="video/mp4">
                                <source src="@videoUrl" type="video/webm">
                                <source src="@videoUrl" type="video/ogg">
                                Your browser does not support the video tag.
                            </video>
                            <div class="card-body">
                                <h6>Video @(videoIndex + 1)</h6>
                                <div class="btn-group w-100" role="group">
                                    <a asp-action="Download" asp-route-url="@videoUrl" class="btn btn-sm btn-outline-success">Download</a>
                                    <form asp-action="Delete" method="post" style="display: inline;">
                                        <input type="hidden" name="url" value="@videoUrl" />
                                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this video?')">Delete</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12">
                    <div class="text-center py-4">
                        <i class="fas fa-video fa-3x text-muted"></i>
                        <p class="mt-3">No videos uploaded yet.</p>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Documents Tab -->
    <div class="tab-pane fade" id="documents" role="tabpanel">
        <div class="card mt-3">
            <div class="card-body">
                @if (documentUrls.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Document</th>
                                    <th>URL</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (int docIndex = 0; docIndex < documentUrls.Count; docIndex++)
                                {
                                    var docUrl = documentUrls[docIndex];
                                    <tr>
                                        <td>
                                            <i class="fas fa-file-alt"></i> Document @(docIndex + 1)
                                        </td>
                                        <td>
                                            <span class="text-truncate" style="max-width: 200px; display: inline-block;" title="@docUrl">
                                                @docUrl
                                            </span>
                                        </td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <a asp-action="Download" asp-route-url="@docUrl" class="btn btn-sm btn-outline-success" title="Download document">
                                                    <i class="fas fa-download"></i>
                                                </a>
                                                <form asp-action="Delete" method="post" style="display: inline;">
                                                    <input type="hidden" name="url" value="@docUrl" />
                                                    <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this document?')" title="Delete document">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="text-center py-4">
                        <i class="fas fa-file-alt fa-3x text-muted"></i>
                        <p class="mt-3">No documents uploaded yet.</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>